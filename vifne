#! /usr/bin/env scheme-script

#!r6rs
;; Copyright 2012 Derick Eddington.  My MIT-style license is in the file named
;; LICENSE from the original collection this file is distributed with.

(import (rnrs base)
        (vifne start)
        (vifne config)
        (vifne host)
        (vifne util command-line))

(process-command-line! "-f" "-n" "-i")

(define storage-file
  (command-line-argument "-f"
                         () string-non-empty?
                         default-storage-file))

(define number-processors
  (command-line-argument "-n"
                         (string->number) exact-positive-integer?
                         (number-host-processors)))

(define initialize-storage-file?
  (command-line-argument "-i"
                         (true-string?) boolean?
                         #F))


(define stop-emulator! (start-emulator! storage-file
                                        initialize-storage-file?
                                        number-processors))
(stop-emulator!)
